# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Database Read Replica (‡πÅ‡∏¢‡∏Å Database ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå)

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ **Read Replica** ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Database ‡∏≠‡∏µ‡∏Å‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏∂‡πà‡∏á (Slave) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **"‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"** (SELECT) ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡πÇ‡∏î‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å Sync ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Database ‡∏´‡∏•‡∏±‡∏Å (Master) ‡πÅ‡∏ö‡∏ö Real-time

### ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ
1.  **‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞ Server ‡πÄ‡∏Å‡∏°:** ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Slave ‡πÅ‡∏ó‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Master (‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏°‡πÉ‡∏ä‡πâ) ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å
2.  **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:** ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏î‡∏ô‡∏¢‡∏¥‡∏á Database ‡∏à‡∏ô‡∏•‡πà‡∏° Server ‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏•‡πà‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
3.  **‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏°‡∏´‡∏≤‡∏®‡∏≤‡∏•:** ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° Slave ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î

---

## üõ†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°
1.  **Master Server:** ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Database ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô Server FiveM ‡∏≠‡∏¢‡∏π‡πà
2.  **Slave Server:** ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Database ‡πÉ‡∏´‡∏°‡πà (‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏ï‡πà‡∏£‡∏±‡∏ô MySQL ‡∏≠‡∏µ‡∏Å Port ‡πÄ‡∏ä‡πà‡∏ô 3307)

---

## üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á (MySQL / MariaDB)

### 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Master (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡∏°)
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `my.ini` (Windows) ‡∏´‡∏£‡∏∑‡∏≠ `my.cnf` (Linux) ‡∏Ç‡∏≠‡∏á Database ‡∏´‡∏•‡∏±‡∏Å:

```ini
[mysqld]
server-id = 1
log_bin = mysql-bin
binlog_do_db = ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ï‡πâ‡∏≤‡πÄ‡∏ö‡∏™_fivem  # ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠ DB ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Sync
```

*‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ Restart MySQL Service*

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ MySQL ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á User ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Replication:
```sql
CREATE USER 'replica_user'@'%' IDENTIFIED BY 'password_secret';
GRANT REPLICATION SLAVE ON *.* TO 'replica_user'@'%';
FLUSH PRIVILEGES;
```

‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Master:
```sql
SHOW MASTER STATUS;
```
*‡∏à‡∏î‡∏Ñ‡πà‡∏≤ `File` ‡πÅ‡∏•‡∏∞ `Position` ‡πÑ‡∏ß‡πâ (‡πÄ‡∏ä‡πà‡∏ô `mysql-bin.000001`, `154`)*

---

### 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Slave (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö)
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `my.ini` ‡∏´‡∏£‡∏∑‡∏≠ `my.cnf` ‡∏Ç‡∏≠‡∏á Database ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà:

```ini
[mysqld]
server-id = 2  # ‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö Master
```

*‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ Restart MySQL Service*

---

### 3. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Slave ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö Master
‡πÄ‡∏Ç‡πâ‡∏≤ MySQL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Slave ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:

```sql
CHANGE MASTER TO
    MASTER_HOST='IP_‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á_Master',
    MASTER_USER='replica_user',
    MASTER_PASSWORD='password_secret',
    MASTER_LOG_FILE='mysql-bin.000001',  -- ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1
    MASTER_LOG_POS=154;                  -- ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1

START SLAVE;
```

‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:
```sql
SHOW SLAVE STATUS \G;
```
*‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡πà‡∏≤ `Slave_IO_Running: Yes` ‡πÅ‡∏•‡∏∞ `Slave_SQL_Running: Yes`*

---

## üíª ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (lib/db.js)

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥ Database ‡πÅ‡∏¢‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ Database ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏ß:
- **‡∏≠‡πà‡∏≤‡∏ô (SELECT):** ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Slave
- **‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô (INSERT, UPDATE):** ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Master

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏ü‡∏•‡πå `lib/db.js`:

```javascript
import mysql from 'mysql2/promise';

// Connection ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô" (Master - ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡∏°)
const masterPool = mysql.createPool({
    host: process.env.DB_HOST_MASTER, // IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Master
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    waitForConnections: true,
    connectionLimit: 10, // ‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡πÜ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
});

// Connection ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏≠‡πà‡∏≤‡∏ô" (Slave - ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö)
const slavePool = mysql.createPool({
    host: process.env.DB_HOST_SLAVE, // IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á Slave
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    waitForConnections: true,
    connectionLimit: 50, // ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Wrapper ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞
const pool = {
    query: async (sql, params) => {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SELECT ‡πÉ‡∏´‡πâ‡πÑ‡∏õ Slave, ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‡πÉ‡∏´‡πâ‡πÑ‡∏õ Master
        const targetPool = sql.trim().toUpperCase().startsWith('SELECT') ? slavePool : masterPool;
        return targetPool.query(sql, params);
    },
    execute: async (sql, params) => {
        const targetPool = sql.trim().toUpperCase().startsWith('SELECT') ? slavePool : masterPool;
        return targetPool.execute(sql, params);
    }
};

export default pool;
```

### ‡∏™‡∏£‡∏∏‡∏õ
‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πá‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Database ‡∏™‡∏≥‡∏£‡∏≠‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Server ‡πÄ‡∏Å‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏∑‡πà‡∏ô‡∏Ñ‡∏ô‡∏™‡∏ö‡∏≤‡∏¢‡πÜ!
